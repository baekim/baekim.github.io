---
date: '2021-07-25'
title: '[Python] ë„¤ì´ë²„ ì˜í™” í˜ì´ì§€ í¬ë¡¤ë§'
categories: ['Database', 'Python', 'MongoDB', 'Sparta']
summary: 'pymongoë¥¼ ì´ìš©í•œ MongoDB ë‹¤ë£¨ê¸°'
thumbnail: './images/python_mongo.png'
---

![image.info](./images/python_mongo.png)

## ë„¤ì´ë²„ ì˜í™” ë­í‚¹, ì œëª©, í‰ì  ê°€ì ¸ì˜¤ê¸°

ë„¤ì´ë²„ ì˜í™” í˜ì´ì§€ì—ì„œ í¬ë¡¤ë§ì„ í†µí•´ ë°ì´í„°ë¥¼ ì œì–´í•˜ê³ ì í•œë‹¤. [ë„¤ì´ë²„ ì˜í™” ë°”ë¡œê°€ê¸°](<https://movie.naver.com/movie/sdb/rank/rmovie.naver?sel=pnt&date=20210723>)

![image.info]('./../images/inside_contents/ë„¤ì´ë²„_ì˜í™”_í˜ì´ì§€_í¬ë¡¤ë§_1.png)<br/>

ğŸ”½ íŒŒì´ì¬ì— requests, BeautifulSoup, pymongo íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œë‹¤.

![image.info]('./../images/inside_contents/ë„¤ì´ë²„_ì˜í™”_í˜ì´ì§€_í¬ë¡¤ë§_2.png)<br/>

ğŸ”½ ìœ„ íŒ¨í‚¤ì§€ë“¤ì„ import ì‹œí‚¤ê³ , mongoDB clientë¥¼ ë¶ˆëŸ¬ì¤€ë‹¤. database nameì€ 'testdb'ë¡œ ì •í–ˆë‹¤.

```python
# crawling_movie_list.py
import requests
from bs4 import BeautifulSoup
from pymongo import MongoClient

client = MongoClient('localhost', 27017)
db = client.testdb
```

ğŸ”½ í¬ë¡¤ë§ì„ ìœ„í•´ ê¸°ë³¸ ë¸Œë¼ìš°ì € ì†ì„±ì„ ì¡ì•„ì£¼ê³ , ë°ì´í„°ë¥¼ ë°›ì•„ì˜¨ë‹¤.

```python
headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36'}
data = requests.get('https://movie.naver.com/movie/sdb/rank/rmovie.nhn?sel=pnt&date=20210723', headers=headers)
```

ğŸ”½ ìœ„ì—ì„œ ë³¸ ë„¤ì´ë²„ ì˜í™” í˜ì´ì§€ì˜ ì „ì²´ <html> ë¥¼ ëª¨ë‘ ê°€ì ¸ì˜¨ë‹¤

```python
soup = BeautifulSoup(data.text, 'html.parser')
```

ğŸ”½ ì´ì œ ìš°ë¦¬ê°€ í•„ìš”í•œ ì˜í™” ì œëª©ë“¤ì„ ê°€ì ¸ì™€ë³´ì.

í¬ë¡¤ë§í•œ source ì½”ë“œë¥¼ ë³´ê³  ê°€ì ¸ì˜¬ ë¶€ë¶„ ê·¼ì²˜ë¥¼ ë³´ê³ , ê°€ì¥ ê°€ê¹Œìš´ ë¶€ëª¨ idê°’ì„ ì°¾ì•„ #íƒœê·¸ë¡œ ë¶ˆëŸ¬ì¤€ë‹¤.

Chrome Browserë¥¼ ì´ìš©í•˜ë©´ í•´ë‹¹ ë¶€ë¶„ì—ì„œ ìš°í´ë¦­ìœ¼ë¡œ copy > copy selector ê¸°ëŠ¥ì„ í†µí•´ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

ê° ì˜í™” ì •ë³´ëŠ” <tr íƒœê·¸> ì•ˆì— ë‹´ê²¨ì ¸ ìˆë‹¤.

```python
tr_tags = soup.select('#old_content > table > tbody > tr')
```

ğŸ”½ ì´ì œ ì˜í™” ì œëª©ì´ ë‹´ê¸´ <a íƒœê·¸> ë¶€ë¶„ì„ ê°€ì ¸ì˜¨ë‹¤.

```python
for tr in tr_tags:
    a_tag = tr.select_one('td.title > div > a')
```

ğŸ”½ ë„¤ì´ë²„ ì˜í™” í˜ì´ì§€ì—ëŠ” 10ê°œ ì˜í™”ë§ˆë‹¤ êµ¬ë¶„ì„ ì´ ì¡´ì¬í•˜ëŠ”ë°, êµ¬ë¶„ì„ ë„ <tr íƒœê·¸> ì•ˆì— ë‹´ê²¨ ìˆê¸° ë•Œë¬¸ì—, for loopë¥¼ ëŒë ¤ í•˜ìœ„ ê°’ì„ ë¶ˆëŸ¬ì˜¤ê³ ìí•˜ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤. ë”°ë¼ì„œ êµ¬ë¶„ì„  ì œì™¸í•˜ëŠ” ì‘ì—…ì´ í•„ìš”í•˜ë‹¤.

êµ¬ë¶„ì„ ì„ ì œì™¸í•˜ê³ , ì˜í™” ì œëª©ì„ ì¶œë ¥í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ 50ê°œì˜ ì˜í™” ì œëª©ì´ ì¶œë ¥ëœë‹¤.

```python
if a_tag is not None:
    title = a_tag.text
    print(title)
    
>> ê·¸ë¦° ë¶
ê°€ë²„ë‚˜ì›€
ë””ì§€ëª¬ ì–´ë“œë²¤ì²˜ ë¼ìŠ¤íŠ¸ ì—ë³¼ë£¨ì…˜ : ì¸ì—°
...
ì‰°ë“¤ëŸ¬ ë¦¬ìŠ¤íŠ¸
í´ë ˆë©˜íƒ€ì¸
ì—¬ì¸ì˜ í–¥ê¸°
```

ğŸ”½ ì œëª©ì´ ì˜ ë“¤ì–´ì˜¤ëŠ” ê²ƒì„ í™•ì¸í–ˆë‹¤ë©´, ì´ì œ ìˆœìœ„, ì œëª©, í‰ì ì„ ê°€ì ¸ì™€ë³´ì.

ìˆœìœ„ëŠ” <img íƒœê·¸> ì•ˆì˜ alt ì†ì„±ì•ˆì— ë“¤ì–´ìˆê³ ,
í‰ì ì€ <td íƒœê·¸> ì¤‘ class="point" ì¸ íƒœê·¸ì•ˆì— ë“¤ì–´ìˆë‹¤.

ê²°ê³¼ë¥¼ í™•ì¸í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ rank, title, stars ìˆœìœ¼ë¡œ ì¶œë ¥í•´ì¤€ë‹¤.

```python
if a_tag is not None:
    rank = tr.select_one('td:nth-child(1) > img')['alt']
    title = a_tag.text
    stars = tr.select_one('td.point').text

    print(rank, title, stars)

>> 01 ê·¸ë¦° ë¶ 9.60
02 ê°€ë²„ë‚˜ì›€ 9.59
03 ë””ì§€ëª¬ ì–´ë“œë²¤ì²˜ ë¼ìŠ¤íŠ¸ ì—ë³¼ë£¨ì…˜ : ì¸ì—° 9.54
...
48 ì‰°ë“¤ëŸ¬ ë¦¬ìŠ¤íŠ¸ 9.37
49 í´ë ˆë©˜íƒ€ì¸ 9.37
50 ì—¬ì¸ì˜ í–¥ê¸° 9.37
```

ğŸ”½ ì´ì œ mongoDBì— ë„£ì–´ë³´ì. ì•ì„œ mongoDBì— testdbë¼ëŠ” collectionì„ ë§Œë“¤ì–´ ë‘ì—ˆë‹¤. ì´ì œ ì•„ë˜ ì½”ë“œë¥¼ í†µí•´ moviesë¼ëŠ” í…Œì´ë¸”ì„ ë§Œë“¤ê³ , ê·¸ ì•ˆì— ì˜í™” ëª©ë¡ì„ ë„£ì–´ë³´ì.

ì˜í™” ìˆœìœ„, ì œëª©, í‰ì ì„ ë”•ì…”ë„ˆë¦¬ë¡œ ë¬¶ì–´ì£¼ê³  insert_one()ì„ í†µí•´ movies í…Œì´ë¸” ì•ˆìœ¼ë¡œ ì¸ì„œíŠ¸ í•´ì¤€ë‹¤.

```python
if a_tag is not None:
    rank = tr.select_one('td:nth-child(1) > img')['alt']
    title = a_tag.text
    stars = tr.select_one('td.point').text

    # print(rank, title, stars)
    item = {
        'rank': rank,
        'title': title,
        'stars': stars
    }
    db.movies.insert_one(item)
```

ğŸ”½ MongoDBë¥¼ í™•ì¸í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ ë“¤ì–´ì˜¤ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

MongoDBë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ 'Robo 3T'ë¼ëŠ” open-source MongoDB GUIë¥¼ ì‚¬ìš©í–ˆë‹¤. [Robo 3T ë°”ë¡œê°€ê¸°](<https://robomongo.org/>)

![image.info]('./../images/inside_contents/ë„¤ì´ë²„_ì˜í™”_í˜ì´ì§€_í¬ë¡¤ë§_3.png)<br/>

ğŸ”½ ì „ì²´ ì½”ë“œë¥¼ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

```python
import requests
from bs4 import BeautifulSoup
from pymongo import MongoClient

client = MongoClient('localhost', 27017)
db = client.testdb

headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)AppleWebKit/537.36 (KHTML, like Gecko) '
                         'Chrome/73.0.3683.86 Safari/537.36'}
data = requests.get('https://movie.naver.com/movie/sdb/rank/rmovie.nhn?sel=pnt&date=20210723', headers=headers)

# í•´ë‹¹ í˜ì´ì§€ì˜ Elements ë¥¼ ëª¨ë‘ ê°€ì ¸ì˜¤ì
soup = BeautifulSoup(data.text, 'html.parser')

# ì˜í™” ì œëª©ë“¤ ê°€ì ¸ì˜¤ê¸° (.select)
tr_tags = soup.select('#old_content > table > tbody > tr')

for tr in tr_tags:
    # ì±… ì œëª©ì´ ë‹´ê¸´ <a íƒœê·¸> ë¶€ë¶„ì„ ê°€ì ¸ì˜¤ì
    a_tag = tr.select_one('td.title > div > a')

    # week3-3 ë¶€ë¶„ë“¤ì´ None ì²˜ë¦¬ë˜ì–´ ë“¤ì–´ì˜¨ë‹¤
    # None ë¶€ë¶„ë“¤ì„ í•„í„°í•˜ê³  ì œëª©ë“¤ ê°€ì ¸ì˜¤ì
    if a_tag is not None:

        # rank, title, evaluation í™•ì¸í•˜ê¸°
        # rank ê°’ì´ ë“¤ì–´ìˆëŠ” ë¶€ë¶„ì¸ <img íƒœê·¸>ë¥¼ ê°€ì ¸ì˜¤ì
        # rank ê°’ì€ 'alt' ì†ì„±ì— ë‹´ê²¨ìˆë‹¤
        rank = tr.select_one('td:nth-child(1) > img')['alt']
        title = a_tag.text
        stars = tr.select_one('td.point').text

        item = {
            'rank': rank,
            'title': title,
            'stars': stars
        }
        db.movies.insert_one(item)
```
